<!--
    Ant build file for sample project.
	For a list of build tasks enter:  ant -p build.xml
 -->
<project name="demo" default="test" basedir=".">
	<description>
    Compile and test some source code.
	</description>

	<!-- location of src and output (build) directory -->
	<!-- the output directory will be deleted and created -->
	<property name="base.dir" location="." />
	<property name="src.dir" location="src"/>
	<property name="build.dir" location="bin"/>
	<property name="test.src.dir" location="${base.dir}/test" />
	<property name="test.build.dir" location="${base.dir}/bin/test" />

	<path id="test.classpath">
		<!-- where is JUnit? -->
		<!-- my computer -->
		<pathelement location="/opt/lib/junit4.9/junit-4.9.jar" />
		<pathelement location="/opt/lib/junit4.9/junit-dep-4.9.jar" />
		<!-- on Travis CI builder -->
		<pathelement location="java/junit.jar" />
		<!-- always need build.dir on the path -->
		<pathelement location="${build.dir}" />
	</path>

	<target name="deps" description="Install dependencies before build">
	   <!-- nothing to install -->
	</target>

	<target name="clean"
		    description="Clean build products by deleting build dir">
	   <delete dir="${build.dir}" />
	</target>

	<!-- create the build directory for output -->
	<target name="init" description="Create output dirs if they don't exist" >
	   <mkdir dir="${build.dir}" />
	   <mkdir dir="${test.build.dir}" />
	</target>

	<!-- compile the source code -->
	<target name="compile" depends="init" description="Compile source code" >
		<javac srcdir="${src.dir}" destdir="${build.dir}" includeantruntime="false" />
	</target>

	<!-- compile the test code (only do this once, using reference src) -->
	<target name="test-compile" depends="init,compile"
		    description="Compile source code for test cases" >
		<javac srcdir="${test.src.dir}" destdir="${test.build.dir}" includeantruntime="false" >
			<classpath refid="test.classpath" />
		</javac>
	</target>

	<!-- create JAR file containing JUnit tests -->
	<target name="jar" depends="compile,test-compile"
		    description="Create JAR file containing test cases" >
		<jar destfile="${dist.dir}/DemoTest.jar" 
			 basedir="${test.build.dir}" >
			<!-- main class not really necesary. -->
			<manifest>
				<attribute name="Main-Class" value="DemoTest"/>
			</manifest>
		</jar>
	</target>

	<!-- Test the code using JUnit. -->
	<target name="test" depends="test-compile" description="Run unit tests" >
		<junit fork="true" printsummary="on" haltonfailure="false">
			<classpath>
				<path refid="test.classpath" />
				<pathelement location="${test.build.dir}" />
			</classpath>
			<batchtest>
				<fileset dir="${test.src.dir}" includes="**/*Test.java" />
			</batchtest>
		</junit>
	</target>

</project>
